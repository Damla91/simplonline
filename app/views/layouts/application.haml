!!!
%html{:lang => 'fr'}
  %head
    %meta{:charset => 'utf-8'}
    %meta{:name => 'viewport', :content => 'width=device-width', 'initial-scale' => '1.0'}
    %title= content_for?(:title) ? yield(:title) : t('.title_window')
    = stylesheet_link_tag 'application'
    = csrf_meta_tags
  %body
    .connexion
      - if current_user
        = link_to "#{current_user.nom.capitalize}", edit_user_path(current_user), title: t('.update_login')
        |
        = form_tag sessions_path, method: 'delete', class: 'little-form' do
          = submit_tag t('.logout')
      - else
        = form_tag sessions_path do
          = label_tag :email, t('.email')
          = email_field_tag :email, nil, placeholder: 'me@example.com', class: 'field'
          = label_tag :password, t('.password')
          = password_field_tag :password, nil, placeholder: 'my secret', class: 'field'

          = submit_tag t('.login'), class: 'small radius secondary', class: 'field button'

    %header.header
      %h1= link_to t('.title'), root_path, class: 'header-title'

      .notification
        - if flash[:error].present?
          %p.label.flash-error= "» #{flash[:error]}"
        - if flash[:alert]
          %p.label.flash-error= "» #{flash[:alert]}"
        - if flash[:notice]
          %p.label.flash-notice= "» #{flash[:notice]}"

    %main.content
      = yield

    %footer.footer
      %p
        = link_to t('.contact'), contact_path, class: 'footer-menu-item'
        = link_to t('.legal'), legal_path, class: 'footer-menu-item'

      %p
        = t('.footer-text')

    = javascript_include_tag 'application'

    :javascript
      function loginViaEmail() {
        navigator.id.get(function(assertion) {
          if (assertion) {
            $('input[name=assertion]').val(assertion);
            $('#browser_id_form').submit();
          } else {
            console.log('Erreur on login persona')
          }
        });
      }
      $(function() {
        $('#browser_id_form button').click(function() {
          loginViaEmail();
          return false;
        });
      });


